<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <title>Th√≠ nghi·ªám AR: H·ªì tinh b·ªôt v√† Iodine</title>
    <!-- Import A-Frame v√† AR.js -->
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        /* Giao di·ªán ng∆∞·ªùi d√πng ƒë√® l√™n camera */
        #ui-layer {
            position: absolute;
            bottom: 20px;
            left: 0;
            width: 100%;
            text-align: center;
            z-index: 10;
            pointer-events: none; /* ƒê·ªÉ c√≥ th·ªÉ thao t√°c 3D n·∫øu c·∫ßn */
        }

        .control-panel {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            display: inline-block;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            pointer-events: auto;
            max-width: 90%;
            border: 1px solid #ddd;
        }

        h3 {
            margin: 0 0 10px 0;
            color: #2c3e50;
            font-size: 18px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        p {
            margin: 5px 0;
            font-size: 15px;
            color: #555;
            line-height: 1.4;
        }

        .hint {
            font-size: 12px;
            color: #7f8c8d;
            font-style: italic;
            margin-top: 5px;
        }

        button {
            background: linear-gradient(135deg, #8e44ad, #9b59b6);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(142, 68, 173, 0.4);
        }

        button:active {
            transform: translateY(2px);
            box-shadow: 0 2px 5px rgba(142, 68, 173, 0.4);
        }

        button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            box-shadow: none;
        }

        #status-text {
            font-weight: bold;
            color: #d35400;
        }
    </style>
</head>
<body style="margin: 0px; overflow: hidden;">

    <!-- UI Overlay -->
    <div id="ui-layer">
        <div class="control-panel">
            <h3>Th√≠ nghi·ªám: H·ªì Tinh B·ªôt + Iodine</h3>
            <p id="instruction">H∆∞·ªõng camera v√†o th·∫ª Hiro ƒë·ªÉ b·∫Øt ƒë·∫ßu.</p>
            <p>Tr·∫°ng th√°i: <span id="status-text">ƒêang chu·∫©n b·ªã...</span></p>
            <p class="hint">üí° M·∫πo: Vu·ªët m√†n h√¨nh tr√°i/ph·∫£i ƒë·ªÉ xoay ·ªëng nghi·ªám.</p>
            <button id="action-btn" onclick="startReaction()">Nh·ªè dung d·ªãch Iodine</button>
            <button id="reset-btn" onclick="resetExperiment()" style="background: linear-gradient(135deg, #7f8c8d, #95a5a6); display: none;">L√†m l·∫°i</button>
        </div>
    </div>

    <!-- AR Scene -->
    <!-- Th√™m renderer="antialias: true; colorManagement: true;" ƒë·ªÉ h√¨nh ·∫£nh m∆∞·ª£t v√† m√†u chu·∫©n h∆°n -->
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;" renderer="antialias: true; colorManagement: true; physicallyCorrectLights: true;">
        
        <!-- H·ªá th·ªëng √°nh s√°ng ƒë·ªÉ t·∫°o kh·ªëi 3D (Quan tr·ªçng cho hi·ªáu ·ª©ng th·ªßy tinh) -->
        <a-entity light="type: ambient; color: #BBB; intensity: 0.8"></a-entity>
        <a-entity light="type: directional; color: #FFF; intensity: 1.2; castShadow: true" position="-1 4 2"></a-entity> <!-- Ch·ªânh l·∫°i v·ªã tr√≠ ƒë√®n cho h·ª£p v·ªõi g√≥c nh√¨n t·ª´ tr√™n xu·ªëng -->
        <a-entity light="type: point; color: #FFF; intensity: 0.8; distance: 10" position="0 5 2"></a-entity>

        <!-- ƒê·ªãnh nghƒ©a Marker Hiro -->
        <a-marker preset="hiro">
            
            <!-- Nh√≥m ch·ª©a to√†n b·ªô d·ª•ng c·ª• th√≠ nghi·ªám -->
            <!-- QUAN TR·ªåNG: ƒê·ªïi rotation v·ªÅ 0 0 0 ƒë·ªÉ ƒë·ª©ng th·∫≥ng tr√™n b√†n -->
            <!-- Th√™m ID ƒë·ªÉ script c√≥ th·ªÉ truy c·∫≠p v√† xoay -->
            <a-entity id="experiment-container" scale="0.6 0.6 0.6" rotation="0 0 0"> 
                
                <!-- 1. GI√Å ƒê·ª† ·ªêNG NGHI·ªÜM (Th√™m v√†o ƒë·ªÉ tƒÉng t√≠nh th·ª±c t·∫ø) -->
                <a-entity position="0 0 -0.5">
                     <a-box position="0 0.2 0" depth="2" height="0.4" width="3" material="color: #8e44ad; roughness: 0.8; metalness: 0.2"></a-box> <!-- ƒê·∫ø -->
                     <a-cylinder position="0 2 0" radius="0.9" height="4" material="color: #95a5a6; wireframe: true; opacity: 0.3"></a-cylinder> <!-- Khung gi·ªØ ·∫£o -->
                </a-entity>

                <!-- 2. ·ªêNG NGHI·ªÜM (Test Tube) - S·ª≠ d·ª•ng v·∫≠t li·ªáu Th·ªßy tinh -->
                <a-entity position="0 0.5 0">
                    <!-- Th√¢n ·ªëng nghi·ªám: transparent, metalness cao ƒë·ªÉ b√≥ng lo√°ng -->
                    <a-cylinder height="4.5" radius="0.8" position="0 2.25 0" 
                        material="color: #ffffff; opacity: 0.3; transparent: true; metalness: 0.9; roughness: 0.1; side: double; depthWrite: false;">
                    </a-cylinder>
                    <!-- ƒê√°y ·ªëng nghi·ªám -->
                    <a-sphere radius="0.8" position="0 0 0" theta-length="90" rotation="180 0 0"
                        material="color: #ffffff; opacity: 0.3; transparent: true; metalness: 0.9; roughness: 0.1; side: double; depthWrite: false;">
                    </a-sphere>
                    <!-- V√†nh mi·ªáng ·ªëng nghi·ªám -->
                    <a-torus radius="0.8" radius-tubular="0.05" position="0 4.5 0" rotation="90 0 0"
                        material="color: #ffffff; opacity: 0.4; transparent: true; metalness: 0.9; roughness: 0.1;">
                    </a-torus>
                    
                    <!-- DUNG D·ªäCH (H·ªì tinh b·ªôt 1%) - B√™n trong ·ªëng nghi·ªám -->
                    <a-entity id="liquid-container" position="0 0.1 0">
                        <!-- Dung d·ªãch h∆°i nh·ªè h∆°n ·ªëng m·ªôt ch√∫t ƒë·ªÉ n·∫±m l·ªçt b√™n trong -->
                        <a-cylinder id="liquid" height="2.5" radius="0.72" position="0 1.25 0"
                            material="color: #F5F5F5; opacity: 0.9; transparent: true; metalness: 0.2; roughness: 0.3">
                        </a-cylinder>
                        <a-sphere id="liquid-bottom" radius="0.72" position="0 0 0" theta-length="90" rotation="180 0 0"
                            material="color: #F5F5F5; opacity: 0.9; transparent: true; metalness: 0.2; roughness: 0.3">
                        </a-sphere>
                        <!-- M·∫∑t tho√°ng ch·∫•t l·ªèng -->
                        <a-circle id="liquid-surface" radius="0.72" position="0 2.5 0" rotation="-90 0 0"
                            material="color: #F5F5F5; opacity: 0.95; transparent: true; metalness: 0.3; roughness: 0.2">
                        </a-circle>
                    </a-entity>
                </a-entity>

                <!-- 3. ·ªêNG H√öT (Dropper) - N√¢ng c·∫•p ch·∫•t li·ªáu -->
                <!-- V·ªã tr√≠ xoay nh·∫π ƒë·ªÉ tr√¥ng t·ª± nhi√™n -->
                <a-entity id="dropper" position="2 6 0" rotation="0 0 -25">
                    <!-- Th√¢n ·ªëng h√∫t (Th·ªßy tinh) -->
                    <a-cylinder height="2.8" radius="0.12" position="0 1.4 0"
                        material="color: #dcdcdc; opacity: 0.4; transparent: true; metalness: 0.8; roughness: 0.1">
                    </a-cylinder>
                    
                    <!-- L√µi ·ªëng h√∫t (Gi·∫£ l·∫≠p ch·∫•t l·ªèng b√™n trong ·ªëng h√∫t) -->
                    <a-cylinder height="1.5" radius="0.06" position="0 1 0"
                        material="color: #5c3817; opacity: 0.8">
                    </a-cylinder>

                    <!-- ƒê·∫ßu b√≥p cao su (M√†u ƒë·ªè, nh√°m - Matte) -->
                    <a-sphere radius="0.35" position="0 2.8 0" scale="1 1.2 1"
                        material="color: #c0392b; roughness: 0.9; metalness: 0.1">
                    </a-sphere>
                    
                    <!-- ƒê·∫ßu nh·ªè gi·ªçt (Th·ªßy tinh vu·ªët nh·ªçn) -->
                    <a-cone height="0.6" radius-bottom="0.12" radius-top="0" position="0 -0.3 0"
                        material="color: #dcdcdc; opacity: 0.4; transparent: true; metalness: 0.8; roughness: 0.1">
                    </a-cone>
                </a-entity>

                <!-- 4. GI·ªåT IODINE (B√≥ng, l·ªèng) -->
                <a-sphere id="iodine-drop" radius="0.12" position="1.1 4.5 0" visible="false"
                    material="color: #5c3817; metalness: 0.6; roughness: 0.2; opacity: 0.9">
                </a-sphere>

                <!-- Nh√£n t√™n h√≥a ch·∫•t (N·ªïi b·∫≠t h∆°n) -->
                <!-- Xoay nh√£n ƒë·ªÉ d·ªÖ ƒë·ªçc t·ª´ g√≥c nh√¨n tr√™n cao -->
                <a-entity position="-2 1 0" rotation="-30 0 0">
                    <a-plane width="2.5" height="0.8" color="#2c3e50" position="0 0 -0.1"></a-plane>
                    <a-text value="Ho Tinh Bot" align="center" position="0 0 0" color="#ecf0f1" width="6"></a-text>
                </a-entity>
            
            </a-entity>
        </a-marker>

        <!-- Camera -->
        <a-entity camera></a-entity>
    </a-scene>

    <script>
        // C√°c bi·∫øn tham chi·∫øu DOM
        const liquid = document.querySelector('#liquid');
        const liquidBottom = document.querySelector('#liquid-bottom');
        const liquidSurface = document.querySelector('#liquid-surface');
        const dropper = document.querySelector('#dropper');
        const iodineDrop = document.querySelector('#iodine-drop');
        const actionBtn = document.querySelector('#action-btn');
        const resetBtn = document.querySelector('#reset-btn');
        const statusText = document.querySelector('#status-text');
        const instruction = document.querySelector('#instruction');
        const container = document.querySelector('#experiment-container');

        // M√†u s·∫Øc
        const COLOR_STARCH = "#F5F5F5"; // M√†u tr·∫Øng ƒë·ª•c c·ªßa h·ªì tinh b·ªôt
        const COLOR_REACTION = "#4B0082"; // M√†u xanh t√≠m ƒë·∫≠m (Indigo)

        // Tr·∫°ng th√°i ban ƒë·∫ßu
        statusText.textContent = "S·∫µn s√†ng. ·ªêng nghi·ªám ch·ª©a 2ml h·ªì tinh b·ªôt 1%.";

        // --- X·ª¨ L√ù XOAY M√î H√åNH (TOUCH/MOUSE DRAG) ---
        let isDragging = false;
        let previousMouseX = 0;

        // S·ª± ki·ªán cho chu·ªôt (Desktop)
        document.addEventListener('mousedown', (e) => {
            isDragging = true;
            previousMouseX = e.clientX;
        });

        document.addEventListener('mousemove', (e) => {
            if (isDragging) {
                const deltaX = e.clientX - previousMouseX;
                container.object3D.rotation.y += deltaX * 0.01; // T·ªëc ƒë·ªô xoay
                previousMouseX = e.clientX;
            }
        });

        document.addEventListener('mouseup', () => {
            isDragging = false;
        });

        // S·ª± ki·ªán cho c·∫£m ·ª©ng (Mobile)
        document.addEventListener('touchstart', (e) => {
            isDragging = true;
            previousMouseX = e.touches[0].clientX;
        });

        document.addEventListener('touchmove', (e) => {
            if (isDragging) {
                const deltaX = e.touches[0].clientX - previousMouseX;
                container.object3D.rotation.y += deltaX * 0.015; // TƒÉng t·ªëc ƒë·ªô ch√∫t cho mobile
                previousMouseX = e.touches[0].clientX;
            }
        });

        document.addEventListener('touchend', () => {
            isDragging = false;
        });
        // --- K·∫æT TH√öC X·ª¨ L√ù XOAY ---

        function startReaction() {
            actionBtn.disabled = true;
            statusText.textContent = "ƒêang nh·ªè dung d·ªãch Iodine...";
            instruction.textContent = "Quan s√°t m√†u s·∫Øc trong ·ªëng nghi·ªám...";

            // 1. Di chuy·ªÉn ·ªëng h√∫t
            dropper.setAttribute('animation', {
                property: 'position',
                to: '0 5.5 0', // Cao h∆°n mi·ªáng ·ªëng nghi·ªám m·ªôt ch√∫t
                dur: 1000,
                easing: 'easeInOutCubic'
            });
            
            dropper.setAttribute('animation__rotate', {
                property: 'rotation',
                to: '0 0 0',
                dur: 1000,
                easing: 'easeInOutCubic'
            });

            // 2. T·∫°o hi·ªáu ·ª©ng nh·ªè gi·ªçt
            setTimeout(() => {
                iodineDrop.setAttribute('visible', 'true');
                iodineDrop.setAttribute('position', '0 5.0 0'); // Xu·∫•t ph√°t t·ª´ ƒë·∫ßu ·ªëng h√∫t
                
                // R∆°i xu·ªëng
                iodineDrop.setAttribute('animation', {
                    property: 'position',
                    to: '0 3.0 0', // R∆°i ch·∫°m m·∫∑t tho√°ng
                    dur: 600,
                    easing: 'easeInQuad'
                });

                // 3. Ph·∫£n ·ª©ng ƒë·ªïi m√†u
                setTimeout(() => {
                    iodineDrop.setAttribute('visible', 'false'); // Bi·∫øn m·∫•t khi ch·∫°m
                    statusText.textContent = "Ph·∫£n ·ª©ng x·∫£y ra!";
                    instruction.textContent = "Dung d·ªãch chuy·ªÉn m√†u Xanh T√≠m ƒë·∫∑c tr∆∞ng.";
                    
                    // C·∫•u h√¨nh animation ƒë·ªïi m√†u
                    const animConfig = {
                        property: 'material.color',
                        to: COLOR_REACTION,
                        dur: 1500,
                        easing: 'linear'
                    };

                    liquid.setAttribute('animation', animConfig);
                    liquidBottom.setAttribute('animation', animConfig);
                    liquidSurface.setAttribute('animation', animConfig);

                    // Hi·ªÉn th·ªã n√∫t Reset
                    setTimeout(() => {
                        actionBtn.style.display = 'none';
                        resetBtn.style.display = 'inline-block';
                    }, 1500);

                }, 600);

            }, 1200);
        }

        function resetExperiment() {
            // Reset UI
            actionBtn.style.display = 'inline-block';
            actionBtn.disabled = false;
            resetBtn.style.display = 'none';
            statusText.textContent = "S·∫µn s√†ng. ·ªêng nghi·ªám ch·ª©a 2ml h·ªì tinh b·ªôt 1%.";
            instruction.textContent = "B·∫•m n√∫t ƒë·ªÉ b·∫Øt ƒë·∫ßu l·∫°i.";

            // Reset 3D Objects
            // Reset m√†u s·∫Øc
            liquid.setAttribute('material', 'color', COLOR_STARCH);
            liquidBottom.setAttribute('material', 'color', COLOR_STARCH);
            liquidSurface.setAttribute('material', 'color', COLOR_STARCH);
            
            liquid.removeAttribute('animation');
            liquidBottom.removeAttribute('animation');
            liquidSurface.removeAttribute('animation');

            // ·ªêng h√∫t v·ªÅ v·ªã tr√≠ c≈©
            dropper.removeAttribute('animation');
            dropper.removeAttribute('animation__rotate');
            dropper.setAttribute('position', '2 6 0');
            dropper.setAttribute('rotation', '0 0 -25');

            // Gi·ªçt n∆∞·ªõc ·∫©n ƒëi
            iodineDrop.setAttribute('visible', 'false');
            iodineDrop.removeAttribute('animation');

            // Reset g√≥c xoay v·ªÅ m·∫∑c ƒë·ªãnh
            container.object3D.rotation.y = 0;
        }
    </script>
</body>
</html>
