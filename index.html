<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <title>Thí nghiệm AR: Hồ tinh bột và Iodine</title>
    <!-- Import A-Frame và AR.js -->
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        /* Giao diện người dùng đè lên camera */
        #ui-layer {
            position: absolute;
            bottom: 20px;
            left: 0;
            width: 100%;
            text-align: center;
            z-index: 10;
            pointer-events: none; /* Để có thể thao tác 3D nếu cần */
        }

        .control-panel {
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 15px;
            display: inline-block;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            pointer-events: auto;
            max-width: 90%;
        }

        h3 {
            margin: 0 0 10px 0;
            color: #2c3e50;
            font-size: 16px;
        }

        p {
            margin: 5px 0;
            font-size: 14px;
            color: #555;
        }

        button {
            background-color: #8e44ad;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
            transition: background 0.3s;
        }

        button:active {
            background-color: #6c3483;
        }

        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        #status-text {
            font-weight: bold;
            color: #e67e22;
        }
    </style>
</head>
<body style="margin: 0px; overflow: hidden;">

    <!-- UI Overlay -->
    <div id="ui-layer">
        <div class="control-panel">
            <h3>Thí nghiệm: Hồ Tinh Bột + Iodine</h3>
            <p id="instruction">Hướng camera vào thẻ Hiro để bắt đầu.</p>
            <p>Trạng thái: <span id="status-text">Đang chuẩn bị...</span></p>
            <button id="action-btn" onclick="startReaction()">Nhỏ dung dịch Iodine</button>
            <button id="reset-btn" onclick="resetExperiment()" style="background-color: #95a5a6; display: none;">Làm lại</button>
        </div>
    </div>

    <!-- AR Scene -->
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;">
        
        <!-- Định nghĩa Marker Hiro -->
        <a-marker preset="hiro">
            
            <!-- Nhóm chứa toàn bộ dụng cụ thí nghiệm -->
            <a-entity scale="0.5 0.5 0.5" rotation="-90 0 0"> <!-- Xoay để đứng thẳng trên marker -->
                
                <!-- 1. Ống nghiệm (Test Tube) -->
                <a-entity position="0 0 0.5">
                    <!-- Thân ống nghiệm (Thủy tinh trong suốt) -->
                    <a-cylinder height="4" radius="0.8" color="white" opacity="0.3" position="0 2 0"></a-cylinder>
                    <!-- Đáy ống nghiệm (Bán cầu) -->
                    <a-sphere radius="0.8" color="white" opacity="0.3" position="0 0 0" theta-length="90" rotation="180 0 0"></a-sphere>
                    
                    <!-- Dung dịch bên trong (Hồ tinh bột 1%) -->
                    <!-- Ban đầu màu trắng đục (#F5F5F5) -->
                    <a-cylinder id="liquid" height="2" radius="0.75" color="#F5F5F5" position="0 1 0" opacity="0.9"></a-cylinder>
                    <a-sphere id="liquid-bottom" radius="0.75" color="#F5F5F5" position="0 0 0" opacity="0.9" theta-length="90" rotation="180 0 0"></a-sphere>
                </a-entity>

                <!-- 2. Ống hút nhỏ giọt (Dropper) -->
                <a-entity id="dropper" position="1.5 6 0.5" rotation="0 0 -20">
                    <!-- Thân ống hút -->
                    <a-cylinder height="2.5" radius="0.1" color="#bdc3c7" position="0 1.25 0"></a-cylinder>
                    <!-- Đầu bóp cao su -->
                    <a-sphere radius="0.3" color="#e74c3c" position="0 2.5 0"></a-sphere>
                    <!-- Đầu nhỏ giọt -->
                    <a-cone height="0.5" radius-bottom="0.1" radius-top="0" color="#bdc3c7" position="0 -0.25 0"></a-cone>
                </a-entity>

                <!-- 3. Giọt dung dịch Iodine (Ẩn ban đầu) -->
                <a-sphere id="iodine-drop" radius="0.15" color="#5c3817" position="0.8 4.5 0.5" visible="false"></a-sphere>

                <!-- Nhãn tên hóa chất -->
                <a-text value="Ho Tinh Bot" position="-2 1 0.5" color="black" scale="2 2 2" rotation="90 0 0"></a-text>
            
            </a-entity>
        </a-marker>

        <!-- Camera -->
        <a-entity camera></a-entity>
    </a-scene>

    <script>
        // Các biến tham chiếu DOM
        const liquid = document.querySelector('#liquid');
        const liquidBottom = document.querySelector('#liquid-bottom');
        const dropper = document.querySelector('#dropper');
        const iodineDrop = document.querySelector('#iodine-drop');
        const actionBtn = document.querySelector('#action-btn');
        const resetBtn = document.querySelector('#reset-btn');
        const statusText = document.querySelector('#status-text');
        const instruction = document.querySelector('#instruction');

        // Màu sắc
        const COLOR_STARCH = "#F5F5F5"; // Màu trắng đục của hồ tinh bột
        const COLOR_REACTION = "#4B0082"; // Màu xanh tím đậm (Indigo) của phản ứng Iodine-Tinh bột

        // Trạng thái ban đầu
        statusText.textContent = "Sẵn sàng. Ống nghiệm chứa 2ml hồ tinh bột 1%.";

        function startReaction() {
            actionBtn.disabled = true;
            statusText.textContent = "Đang nhỏ dung dịch Iodine...";
            instruction.textContent = "Quan sát hiện tượng...";

            // 1. Di chuyển ống hút vào vị trí phía trên ống nghiệm
            dropper.setAttribute('animation', {
                property: 'position',
                to: '0 5 0.5',
                dur: 1000,
                easing: 'easeInOutQuad'
            });
            
            dropper.setAttribute('animation__rotate', {
                property: 'rotation',
                to: '0 0 0',
                dur: 1000,
                easing: 'easeInOutQuad'
            });

            // 2. Sau khi ống hút đến nơi, tạo hiệu ứng nhỏ giọt
            setTimeout(() => {
                iodineDrop.setAttribute('visible', 'true');
                iodineDrop.setAttribute('position', '0 4.5 0.5'); // Đặt lại vị trí xuất phát ở đầu ống hút
                
                // Rơi xuống
                iodineDrop.setAttribute('animation', {
                    property: 'position',
                    to: '0 2 0.5', // Rơi vào dung dịch
                    dur: 800,
                    easing: 'easeInQuad'
                });

                // 3. Phản ứng đổi màu (Mô phỏng lắc nhẹ và đổi màu)
                setTimeout(() => {
                    iodineDrop.setAttribute('visible', 'false'); // Giọt biến mất khi chạm mặt nước
                    statusText.textContent = "Dung dịch chuyển sang màu xanh tím!";
                    instruction.textContent = "Hiện tượng: Iốt gặp tinh bột tạo màu xanh tím.";
                    
                    // Đổi màu thân dung dịch
                    liquid.setAttribute('animation', {
                        property: 'color',
                        to: COLOR_REACTION,
                        dur: 1500,
                        easing: 'linear'
                    });
                    
                    // Đổi màu đáy dung dịch
                    liquidBottom.setAttribute('animation', {
                        property: 'color',
                        to: COLOR_REACTION,
                        dur: 1500,
                        easing: 'linear'
                    });

                    // Hiển thị nút Reset
                    actionBtn.style.display = 'none';
                    resetBtn.style.display = 'inline-block';

                }, 800);

            }, 1200);
        }

        function resetExperiment() {
            // Reset UI
            actionBtn.style.display = 'inline-block';
            actionBtn.disabled = false;
            resetBtn.style.display = 'none';
            statusText.textContent = "Sẵn sàng. Ống nghiệm chứa 2ml hồ tinh bột 1%.";
            instruction.textContent = "Bấm nút để bắt đầu lại.";

            // Reset 3D Objects
            // Màu về trắng
            liquid.setAttribute('color', COLOR_STARCH);
            liquidBottom.setAttribute('color', COLOR_STARCH);
            liquid.removeAttribute('animation');
            liquidBottom.removeAttribute('animation');

            // Ống hút về vị trí cũ
            dropper.removeAttribute('animation');
            dropper.removeAttribute('animation__rotate');
            dropper.setAttribute('position', '1.5 6 0.5');
            dropper.setAttribute('rotation', '0 0 -20');

            // Giọt nước ẩn đi
            iodineDrop.setAttribute('visible', 'false');
            iodineDrop.removeAttribute('animation');
        }
    </script>
</body>
</html>
