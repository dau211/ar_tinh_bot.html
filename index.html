<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <title>Phòng Thí Nghiệm Ảo AR</title>
    <!-- Import A-Frame và AR.js -->
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Segoe UI', sans-serif; }
        #ui-layer {
            position: absolute;
            bottom: 20px;
            left: 0;
            width: 100%;
            text-align: center;
            z-index: 10;
            pointer-events: none;
        }
        .control-panel {
            background: rgba(10, 25, 47, 0.85);
            padding: 15px 25px;
            border-radius: 15px;
            display: inline-block;
            box-shadow: 0 0 20px rgba(0,255,255,0.2);
            pointer-events: auto;
            border: 1px solid #00e5ff;
            color: white;
            backdrop-filter: blur(10px);
        }
        h3 { margin: 0 0 5px 0; font-size: 16px; color: #00e5ff; text-transform: uppercase; }
        button {
            background: linear-gradient(135deg, #00b4d8, #0077b6);
            color: white; border: none; padding: 10px 20px; border-radius: 5px;
            font-weight: bold; cursor: pointer; margin-top: 10px; transition: 0.3s;
        }
        button:hover { box-shadow: 0 0 15px #00e5ff; }
        #status-text { color: #f1c40f; font-size: 13px; }
    </style>
</head>
<body style="margin: 0px; overflow: hidden;">

    <div id="ui-layer">
        <div class="control-panel">
            <h3>Hệ Thống Thực Hành Ảo v2.0</h3>
            <p id="status-text">Đang thiết lập phòng Lab...</p>
            <button id="action-btn" onclick="startReaction()">Tiến hành thí nghiệm</button>
            <button id="reset-btn" onclick="location.reload()" style="display: none; background: #e74c3c;">Làm mới phòng Lab</button>
        </div>
    </div>

    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;" renderer="antialias: true; colorManagement: true;">
        
        <a-assets>
            <!-- Texture giả lập mặt bàn đá và tường -->
            <a-mixin id="wall-mat" material="color: #e3f2fd; roughness: 0.8; metalness: 0.1"></a-mixin>
            <a-mixin id="table-mat" material="color: #2c3e50; roughness: 0.3; metalness: 0.5"></a-mixin>
        </a-assets>

        <a-marker preset="hiro" id="hiro-marker">
            <a-entity id="main-rig" scale="0.5 0.5 0.5">
                
                <!-- CẤU TRÚC PHÒNG THỰC HÀNH (VIRTUAL ENVIRONMENT) -->
                <a-entity id="lab-environment">
                    <!-- Sàn phòng lab -->
                    <a-plane width="10" height="10" rotation="-90 0 0" material="color: #bdc3c7; src: url(https://fany.savina.com/wp-content/uploads/2021/05/tile-texture.jpg); repeat: 5 5"></a-plane>
                    
                    <!-- HỆ THỐNG TƯỜNG XUNG QUANH -->
                    <!-- Tường sau -->
                    <a-box position="0 2.5 -5" width="10" height="5" depth="0.2" mixin="wall-mat"></a-box>
                    <!-- Tường trái -->
                    <a-box position="-5 2.5 0" width="0.2" height="5" depth="10" mixin="wall-mat"></a-box>
                    <!-- Tường phải -->
                    <a-box position="5 2.5 0" width="0.2" height="5" depth="10" mixin="wall-mat"></a-box>
                    
                    <!-- Trang trí tường sau (Cửa sổ hoặc bảng tên phòng lab) -->
                    <a-plane position="0 3 -4.85" width="4" height="2" color="#cfd8dc" material="opacity: 0.5; transparent: true"></a-plane>
                    <a-text value="BIOLOGY & CHEMISTRY LAB" align="center" position="0 3.5 -4.8" color="#455a64" width="6"></a-text>

                    <!-- Bàn thí nghiệm chính -->
                    <a-box position="0 0.75 0" width="4" height="1.5" depth="2" mixin="table-mat">
                        <a-box position="0 0.75 0" width="4.1" height="0.1" depth="2.1" material="color: #95a5a6; metalness: 0.8"></a-box>
                    </a-box>

                    <!-- Kệ để hóa chất trên tường sau -->
                    <a-entity position="0 0 -4.5">
                        <a-box position="0 2 0" width="6" height="0.1" depth="0.5" material="color: #546e7a"></a-box>
                        <!-- Các lọ hóa chất trang trí -->
                        <a-cylinder position="-1.5 2.4 0" radius="0.15" height="0.6" material="color: #fbc02d; opacity: 0.8"></a-cylinder>
                        <a-cylinder position="-1 2.4 0" radius="0.12" height="0.5" material="color: #d32f2f; opacity: 0.8"></a-cylinder>
                        <a-cylinder position="1 2.4 0" radius="0.18" height="0.7" material="color: #1976d2; opacity: 0.8"></a-cylinder>
                        <a-cylinder position="1.6 2.4 0" radius="0.12" height="0.4" material="color: #388e3c; opacity: 0.8"></a-cylinder>
                    </a-entity>
                </a-entity>

                <!-- KHU VỰC THÍ NGHIỆM CHI TIẾT (Giữ nguyên code cũ) -->
                <a-entity id="experiment-zone" position="0 1.55 0">
                    
                    <!-- Ống nghiệm thủy tinh -->
                    <a-entity id="test-tube-unit">
                        <a-cylinder height="3" radius="0.4" material="color: #fff; opacity: 0.2; transparent: true; metalness: 1; roughness: 0"></a-cylinder>
                        <a-sphere position="0 -1.5 0" radius="0.4" theta-length="90" rotation="180 0 0" material="color: #fff; opacity: 0.2; transparent: true"></a-sphere>
                        
                        <!-- Dung dịch -->
                        <a-entity id="liquid-contain">
                            <a-cylinder id="liquid" height="1.2" radius="0.38" position="0 -0.8 0" material="color: #ffffff; opacity: 0.7; transparent: true"></a-cylinder>
                            <a-circle id="liquid-surface" radius="0.38" position="0 -0.2 0" rotation="-90 0 0" material="color: #ffffff; opacity: 0.9"></a-circle>
                        </a-entity>
                    </a-entity>

                    <!-- Pipette -->
                    <a-entity id="dropper" position="1.5 3 0" rotation="0 0 -20">
                        <a-sphere radius="0.25" scale="1 1.5 1" material="color: #2c3e50"></a-sphere>
                        <a-cylinder height="2" radius="0.05" position="0 -1.2 0" material="color: #fff; opacity: 0.3; transparent: true"></a-cylinder>
                        <a-cylinder height="0.6" radius="0.03" position="0 -1.5 0" material="color: #8b4513"></a-cylinder>
                    </a-entity>

                    <a-sphere id="iodine-drop" radius="0.05" material="color: #8b4513" visible="false"></a-sphere>
                </a-entity>

                <!-- Ánh sáng nội bộ -->
                <a-entity light="type: point; intensity: 0.8; distance: 20" position="0 4 0"></a-entity>
            </a-entity>
        </a-marker>

        <a-entity camera></a-entity>
    </a-scene>

    <script>
        const marker = document.querySelector('#hiro-marker');
        const rig = document.querySelector('#main-rig');
        const statusText = document.querySelector('#status-text');
        const liquid = document.querySelector('#liquid');
        const liquidSurface = document.querySelector('#liquid-surface');
        const dropper = document.querySelector('#dropper');
        const iodineDrop = document.querySelector('#iodine-drop');

        function syncLab() {
            if (marker.object3D.visible) {
                const rot = marker.object3D.rotation;
                rig.object3D.rotation.x = -rot.x;
                rig.object3D.rotation.z = -rot.z;
            }
            requestAnimationFrame(syncLab);
        }
        syncLab();

        function startReaction() {
            document.querySelector('#action-btn').disabled = true;
            statusText.textContent = "Hệ thống: Đang trích xuất Iodine...";

            dropper.setAttribute('animation', { property: 'position', to: '0 3.5 0', dur: 1000, easing: 'easeInOutQuad' });
            dropper.setAttribute('animation__2', { property: 'rotation', to: '0 0 0', dur: 800 });

            setTimeout(() => {
                iodineDrop.setAttribute('visible', 'true');
                iodineDrop.setAttribute('position', '0 2 0');
                iodineDrop.setAttribute('animation', { property: 'position', to: '0 1.2 0', dur: 600 });

                setTimeout(() => {
                    iodineDrop.setAttribute('visible', 'false');
                    statusText.textContent = "Phản ứng thành công: Xuất hiện phức màu Xanh Tím!";
                    
                    const starchBlue = "#1a237e";
                    liquid.setAttribute('animation', { property: 'material.color', to: starchBlue, dur: 1500 });
                    liquidSurface.setAttribute('animation', { property: 'material.color', to: starchBlue, dur: 1500 });

                    document.querySelector('#action-btn').style.display = 'none';
                    document.querySelector('#reset-btn').style.display = 'inline-block';
                }, 650);
            }, 1200);
        }

        marker.addEventListener('markerFound', () => { statusText.textContent = "Phòng Lab ảo đã sẵn sàng!"; });
    </script>
</body>
</html>
