<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <title>Th√≠ nghi·ªám AR: H·ªì tinh b·ªôt v√† Iodine</title>
    <!-- Import A-Frame v√† AR.js -->
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        #ui-layer {
            position: absolute;
            bottom: 20px;
            left: 0;
            width: 100%;
            text-align: center;
            z-index: 10;
            pointer-events: none;
        }

        .control-panel {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 15px;
            display: inline-block;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            pointer-events: auto;
            max-width: 90%;
            border: 1px solid #ddd;
        }

        h3 {
            margin: 0 0 5px 0;
            color: #2c3e50;
            font-size: 16px;
            text-transform: uppercase;
        }

        p {
            margin: 3px 0;
            font-size: 13px;
            color: #555;
        }

        .hint {
            font-size: 11px;
            color: #e67e22;
            font-weight: bold;
            margin-top: 5px;
        }

        button {
            background: linear-gradient(135deg, #8e44ad, #9b59b6);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s;
        }

        button:active {
            transform: scale(0.95);
        }

        button:disabled {
            background: #bdc3c7;
        }

        #status-text {
            font-weight: bold;
            color: #d35400;
        }

        /* H∆∞·ªõng d·∫´n t∆∞∆°ng t√°c m·ªõi */
        .interaction-guide {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.5);
            color: white;
            padding: 10px;
            border-radius: 8px;
            font-size: 12px;
            text-align: left;
            pointer-events: none;
        }
    </style>
</head>
<body style="margin: 0px; overflow: hidden;">

    <div class="interaction-guide">
        üñêÔ∏è 1 ng√≥n: Xoay d·ª•ng c·ª•<br>
        ‚úåÔ∏è 2 ng√≥n: Ph√≥ng to/Thu nh·ªè<br>
        üîÑ Gi·ªØ Shift + k√©o: Ch·ªânh ƒë·ªô nghi√™ng
    </div>

    <div id="ui-layer">
        <div class="control-panel">
            <h3>Th√≠ nghi·ªám: H·ªì Tinh B·ªôt + Iodine</h3>
            <p id="instruction">H∆∞·ªõng camera v√†o th·∫ª Hiro.</p>
            <p>Tr·∫°ng th√°i: <span id="status-text">ƒêang ƒë·ª£i th·∫ª Hiro...</span></p>
            <button id="action-btn" onclick="startReaction()">Nh·ªè dung d·ªãch Iodine</button>
            <button id="reset-btn" onclick="resetExperiment()" style="background: #7f8c8d; display: none;">L√†m l·∫°i</button>
            <p class="hint">B·∫°n c√≥ th·ªÉ xoay v√† ph√≥ng to ƒë·ªÉ nh√¨n r√µ h∆°n!</p>
        </div>
    </div>

    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;" renderer="antialias: true; colorManagement: true;">
        
        <a-entity light="type: ambient; color: #BBB; intensity: 1"></a-entity>
        <a-entity light="type: directional; color: #FFF; intensity: 1.2" position="-1 4 2"></a-entity>

        <a-marker preset="hiro">
            <!-- Container ch√≠nh c√≥ th·ªÉ xoay, ph√≥ng to, thu nh·ªè -->
            <a-entity id="main-rig" scale="0.6 0.6 0.6" rotation="0 0 0">
                
                <!-- GI√Å ƒê·ª† -->
                <a-entity position="0 0 -0.5">
                     <a-box position="0 0.1 0" depth="1.5" height="0.2" width="2.5" material="color: #2c3e50; metalness: 0.5"></a-box>
                     <a-cylinder position="0 1.5 0" radius="0.85" height="3" material="color: #95a5a6; wireframe: true; opacity: 0.2"></a-cylinder>
                </a-entity>

                <!-- ·ªêNG NGHI·ªÜM TH·ª¶Y TINH -->
                <a-entity position="0 0.5 0">
                    <a-cylinder height="4" radius="0.7" position="0 2 0" 
                        material="color: #ffffff; opacity: 0.2; transparent: true; metalness: 1; roughness: 0; side: double; depthWrite: false;">
                    </a-cylinder>
                    <a-sphere radius="0.7" position="0 0 0" theta-length="90" rotation="180 0 0"
                        material="color: #ffffff; opacity: 0.2; transparent: true; metalness: 1; roughness: 0; side: double; depthWrite: false;">
                    </a-sphere>
                    
                    <!-- CH·∫§T L·ªéNG -->
                    <a-entity id="liquid-group">
                        <a-cylinder id="liquid" height="1.8" radius="0.65" position="0 0.9 0"
                            material="color: #F5F5F5; opacity: 0.8; transparent: true; roughness: 0.3">
                        </a-cylinder>
                        <a-sphere id="liquid-bottom" radius="0.65" position="0 0 0" theta-length="90" rotation="180 0 0"
                            material="color: #F5F5F5; opacity: 0.8; transparent: true; roughness: 0.3">
                        </a-sphere>
                        <a-circle id="liquid-surface" radius="0.65" position="0 1.8 0" rotation="-90 0 0"
                            material="color: #F5F5F5; opacity: 0.9; transparent: true;">
                        </a-circle>
                    </a-entity>
                </a-entity>

                <!-- ·ªêNG H√öT -->
                <a-entity id="dropper" position="1.5 5.5 0" rotation="0 0 -20">
                    <a-cylinder height="2.5" radius="0.1" material="color: #ffffff; opacity: 0.3; transparent: true; metalness: 0.8"></a-cylinder>
                    <a-cylinder height="1.2" radius="0.05" position="0 0.5 0" material="color: #5c3817; opacity: 0.8"></a-cylinder>
                    <a-sphere radius="0.3" position="0 1.4 0" material="color: #c0392b; roughness: 1"></a-sphere>
                </a-entity>

                <!-- GI·ªåT DUNG D·ªäCH -->
                <a-sphere id="iodine-drop" radius="0.1" color="#5c3817" visible="false"></a-sphere>

                <a-text value="H·ªì tinh b·ªôt 1%" position="-1.5 0.5 1" rotation="-90 0 0" color="black" width="4"></a-text>
            </a-entity>
        </a-marker>

        <a-entity camera></a-entity>
    </a-scene>

    <script>
        const rig = document.querySelector('#main-rig');
        const liquid = document.querySelector('#liquid');
        const liquidBottom = document.querySelector('#liquid-bottom');
        const liquidSurface = document.querySelector('#liquid-surface');
        const dropper = document.querySelector('#dropper');
        const iodineDrop = document.querySelector('#iodine-drop');
        const actionBtn = document.querySelector('#action-btn');
        const resetBtn = document.querySelector('#reset-btn');
        const statusText = document.querySelector('#status-text');

        // Bi·∫øn ƒëi·ªÅu khi·ªÉn t∆∞∆°ng t√°c
        let isDragging = false;
        let prevX = 0, prevY = 0;
        let initialDist = 0;
        let currentScale = 0.6;

        // X·ª≠ l√Ω ch·∫°m/chu·ªôt ƒë·ªÉ xoay v√† ph√≥ng to
        document.addEventListener('mousedown', e => { isDragging = true; prevX = e.clientX; prevY = e.clientY; });
        document.addEventListener('touchstart', e => {
            if (e.touches.length === 1) {
                isDragging = true;
                prevX = e.touches[0].clientX;
                prevY = e.touches[0].clientY;
            } else if (e.touches.length === 2) {
                initialDist = Math.hypot(e.touches[0].pageX - e.touches[1].pageX, e.touches[0].pageY - e.touches[1].pageY);
            }
        });

        document.addEventListener('mousemove', e => {
            if (!isDragging) return;
            let dx = e.clientX - prevX;
            let dy = e.clientY - prevY;
            
            if (e.shiftKey) { // Ch·ªânh ƒë·ªô nghi√™ng khi gi·ªØ Shift
                rig.object3D.rotation.x += dy * 0.01;
            } else {
                rig.object3D.rotation.y += dx * 0.01;
            }
            prevX = e.clientX; prevY = e.clientY;
        });

        document.addEventListener('touchmove', e => {
            if (e.touches.length === 1 && isDragging) {
                let dx = e.touches[0].clientX - prevX;
                let dy = e.touches[0].clientY - prevY;
                rig.object3D.rotation.y += dx * 0.015;
                // C√≥ th·ªÉ th√™m xoay X n·∫øu mu·ªën ƒëi·ªÅu ch·ªânh ƒë·ªô ƒë·ª©ng
                prevX = e.touches[0].clientX;
                prevY = e.touches[0].clientY;
            } else if (e.touches.length === 2) {
                let dist = Math.hypot(e.touches[0].pageX - e.touches[1].pageX, e.touches[0].pageY - e.touches[1].pageY);
                let zoom = dist / initialDist;
                currentScale = Math.min(Math.max(currentScale * zoom, 0.2), 2.0);
                rig.setAttribute('scale', `${currentScale} ${currentScale} ${currentScale}`);
                initialDist = dist;
            }
        });

        document.addEventListener('mouseup', () => isDragging = false);
        document.addEventListener('touchend', () => isDragging = false);
        
        // Zoom b·∫±ng con lƒÉn chu·ªôt
        document.addEventListener('wheel', e => {
            currentScale -= e.deltaY * 0.001;
            currentScale = Math.min(Math.max(currentScale, 0.2), 2.0);
            rig.setAttribute('scale', `${currentScale} ${currentScale} ${currentScale}`);
        });

        function startReaction() {
            actionBtn.disabled = true;
            statusText.textContent = "ƒêang nh·ªè I·ªët...";

            // Di chuy·ªÉn ·ªëng h√∫t t·ªõi mi·ªáng ·ªëng nghi·ªám
            dropper.setAttribute('animation', { property: 'position', to: '0 5 0', dur: 1000 });
            dropper.setAttribute('animation__2', { property: 'rotation', to: '0 0 0', dur: 1000 });

            setTimeout(() => {
                iodineDrop.setAttribute('visible', 'true');
                iodineDrop.setAttribute('position', '0 4.5 0');
                iodineDrop.setAttribute('animation', { property: 'position', to: '0 2.2 0', dur: 800 });

                setTimeout(() => {
                    iodineDrop.setAttribute('visible', 'false');
                    statusText.textContent = "Ph·∫£n ·ª©ng: Xu·∫•t hi·ªán m√†u xanh t√≠m!";
                    
                    const bluePurple = "#4B0082";
                    liquid.setAttribute('animation', { property: 'material.color', to: bluePurple, dur: 1500 });
                    liquidBottom.setAttribute('animation', { property: 'material.color', to: bluePurple, dur: 1500 });
                    liquidSurface.setAttribute('animation', { property: 'material.color', to: bluePurple, dur: 1500 });

                    actionBtn.style.display = 'none';
                    resetBtn.style.display = 'inline-block';
                }, 850);
            }, 1100);
        }

        function resetExperiment() {
            location.reload(); // C√°ch nhanh nh·∫•t ƒë·ªÉ reset to√†n b·ªô tr·∫°ng th√°i AR
        }

        // C·∫≠p nh·∫≠t tr·∫°ng th√°i khi t√¨m th·∫•y marker
        document.querySelector('a-marker').addEventListener('markerFound', () => {
            statusText.textContent = "ƒê√£ t√¨m th·∫•y th·∫ª Hiro. S·∫µn s√†ng!";
        });
    </script>
</body>
</html>
