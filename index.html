<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <title>Thí nghiệm AR: Hồ tinh bột và Iodine</title>
    <!-- Import A-Frame và AR.js -->
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        /* Giao diện người dùng đè lên camera */
        #ui-layer {
            position: absolute;
            bottom: 20px;
            left: 0;
            width: 100%;
            text-align: center;
            z-index: 10;
            pointer-events: none; /* Để có thể thao tác 3D nếu cần */
        }

        .control-panel {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            display: inline-block;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            pointer-events: auto;
            max-width: 90%;
            border: 1px solid #ddd;
        }

        h3 {
            margin: 0 0 10px 0;
            color: #2c3e50;
            font-size: 18px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        p {
            margin: 5px 0;
            font-size: 15px;
            color: #555;
            line-height: 1.4;
        }

        button {
            background: linear-gradient(135deg, #8e44ad, #9b59b6);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(142, 68, 173, 0.4);
        }

        button:active {
            transform: translateY(2px);
            box-shadow: 0 2px 5px rgba(142, 68, 173, 0.4);
        }

        button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            box-shadow: none;
        }

        #status-text {
            font-weight: bold;
            color: #d35400;
        }
    </style>
</head>
<body style="margin: 0px; overflow: hidden;">

    <!-- UI Overlay -->
    <div id="ui-layer">
        <div class="control-panel">
            <h3>Thí nghiệm: Hồ Tinh Bột + Iodine</h3>
            <p id="instruction">Hướng camera vào thẻ Hiro để bắt đầu.</p>
            <p>Trạng thái: <span id="status-text">Đang chuẩn bị...</span></p>
            <button id="action-btn" onclick="startReaction()">Nhỏ dung dịch Iodine</button>
            <button id="reset-btn" onclick="resetExperiment()" style="background: linear-gradient(135deg, #7f8c8d, #95a5a6); display: none;">Làm lại</button>
        </div>
    </div>

    <!-- AR Scene -->
    <!-- Thêm renderer="antialias: true; colorManagement: true;" để hình ảnh mượt và màu chuẩn hơn -->
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;" renderer="antialias: true; colorManagement: true; physicallyCorrectLights: true;">
        
        <!-- Hệ thống ánh sáng để tạo khối 3D (Quan trọng cho hiệu ứng thủy tinh) -->
        <a-entity light="type: ambient; color: #BBB; intensity: 0.8"></a-entity>
        <a-entity light="type: directional; color: #FFF; intensity: 1.2; castShadow: true" position="-1 2 1"></a-entity>
        <a-entity light="type: point; color: #FFF; intensity: 0.8; distance: 10" position="0 3 2"></a-entity>

        <!-- Định nghĩa Marker Hiro -->
        <a-marker preset="hiro">
            
            <!-- Nhóm chứa toàn bộ dụng cụ thí nghiệm -->
            <a-entity scale="0.6 0.6 0.6" rotation="-90 0 0"> <!-- Xoay để đứng thẳng trên marker -->
                
                <!-- 1. GIÁ ĐỠ ỐNG NGHIỆM (Thêm vào để tăng tính thực tế) -->
                <a-entity position="0 0 -0.5">
                     <a-box position="0 0.2 0" depth="2" height="0.4" width="3" material="color: #8e44ad; roughness: 0.8; metalness: 0.2"></a-box> <!-- Đế -->
                     <a-cylinder position="0 2 0" radius="0.9" height="4" material="color: #95a5a6; wireframe: true; opacity: 0.3"></a-cylinder> <!-- Khung giữ ảo -->
                </a-entity>

                <!-- 2. ỐNG NGHIỆM (Test Tube) - Sử dụng vật liệu Thủy tinh -->
                <a-entity position="0 0.5 0">
                    <!-- Thân ống nghiệm: transparent, metalness cao để bóng loáng -->
                    <a-cylinder height="4.5" radius="0.8" position="0 2.25 0" 
                        material="color: #ffffff; opacity: 0.3; transparent: true; metalness: 0.9; roughness: 0.1; side: double; depthWrite: false;">
                    </a-cylinder>
                    <!-- Đáy ống nghiệm -->
                    <a-sphere radius="0.8" position="0 0 0" theta-length="90" rotation="180 0 0"
                        material="color: #ffffff; opacity: 0.3; transparent: true; metalness: 0.9; roughness: 0.1; side: double; depthWrite: false;">
                    </a-sphere>
                    <!-- Vành miệng ống nghiệm -->
                    <a-torus radius="0.8" radius-tubular="0.05" position="0 4.5 0" rotation="90 0 0"
                        material="color: #ffffff; opacity: 0.4; transparent: true; metalness: 0.9; roughness: 0.1;">
                    </a-torus>
                    
                    <!-- DUNG DỊCH (Hồ tinh bột 1%) - Bên trong ống nghiệm -->
                    <a-entity id="liquid-container" position="0 0.1 0">
                        <!-- Dung dịch hơi nhỏ hơn ống một chút để nằm lọt bên trong -->
                        <a-cylinder id="liquid" height="2.5" radius="0.72" position="0 1.25 0"
                            material="color: #F5F5F5; opacity: 0.9; transparent: true; metalness: 0.2; roughness: 0.3">
                        </a-cylinder>
                        <a-sphere id="liquid-bottom" radius="0.72" position="0 0 0" theta-length="90" rotation="180 0 0"
                            material="color: #F5F5F5; opacity: 0.9; transparent: true; metalness: 0.2; roughness: 0.3">
                        </a-sphere>
                        <!-- Mặt thoáng chất lỏng -->
                        <a-circle id="liquid-surface" radius="0.72" position="0 2.5 0" rotation="-90 0 0"
                            material="color: #F5F5F5; opacity: 0.95; transparent: true; metalness: 0.3; roughness: 0.2">
                        </a-circle>
                    </a-entity>
                </a-entity>

                <!-- 3. ỐNG HÚT (Dropper) - Nâng cấp chất liệu -->
                <a-entity id="dropper" position="2 6 0" rotation="0 0 -25">
                    <!-- Thân ống hút (Thủy tinh) -->
                    <a-cylinder height="2.8" radius="0.12" position="0 1.4 0"
                        material="color: #dcdcdc; opacity: 0.4; transparent: true; metalness: 0.8; roughness: 0.1">
                    </a-cylinder>
                    
                    <!-- Lõi ống hút (Giả lập chất lỏng bên trong ống hút) -->
                    <a-cylinder height="1.5" radius="0.06" position="0 1 0"
                        material="color: #5c3817; opacity: 0.8">
                    </a-cylinder>

                    <!-- Đầu bóp cao su (Màu đỏ, nhám - Matte) -->
                    <a-sphere radius="0.35" position="0 2.8 0" scale="1 1.2 1"
                        material="color: #c0392b; roughness: 0.9; metalness: 0.1">
                    </a-sphere>
                    
                    <!-- Đầu nhỏ giọt (Thủy tinh vuốt nhọn) -->
                    <a-cone height="0.6" radius-bottom="0.12" radius-top="0" position="0 -0.3 0"
                        material="color: #dcdcdc; opacity: 0.4; transparent: true; metalness: 0.8; roughness: 0.1">
                    </a-cone>
                </a-entity>

                <!-- 4. GIỌT IODINE (Bóng, lỏng) -->
                <a-sphere id="iodine-drop" radius="0.12" position="1.1 4.5 0" visible="false"
                    material="color: #5c3817; metalness: 0.6; roughness: 0.2; opacity: 0.9">
                </a-sphere>

                <!-- Nhãn tên hóa chất (Nổi bật hơn) -->
                <a-entity position="-2 1 0" rotation="0 0 0">
                    <a-plane width="2.5" height="0.8" color="#2c3e50" position="0 0 -0.1"></a-plane>
                    <a-text value="Ho Tinh Bot" align="center" position="0 0 0" color="#ecf0f1" width="6"></a-text>
                </a-entity>
            
            </a-entity>
        </a-marker>

        <!-- Camera -->
        <a-entity camera></a-entity>
    </a-scene>

    <script>
        // Các biến tham chiếu DOM
        const liquid = document.querySelector('#liquid');
        const liquidBottom = document.querySelector('#liquid-bottom');
        const liquidSurface = document.querySelector('#liquid-surface');
        const dropper = document.querySelector('#dropper');
        const iodineDrop = document.querySelector('#iodine-drop');
        const actionBtn = document.querySelector('#action-btn');
        const resetBtn = document.querySelector('#reset-btn');
        const statusText = document.querySelector('#status-text');
        const instruction = document.querySelector('#instruction');

        // Màu sắc
        const COLOR_STARCH = "#F5F5F5"; // Màu trắng đục của hồ tinh bột
        const COLOR_REACTION = "#4B0082"; // Màu xanh tím đậm (Indigo)

        // Trạng thái ban đầu
        statusText.textContent = "Sẵn sàng. Ống nghiệm chứa 2ml hồ tinh bột 1%.";

        function startReaction() {
            actionBtn.disabled = true;
            statusText.textContent = "Đang nhỏ dung dịch Iodine...";
            instruction.textContent = "Quan sát màu sắc trong ống nghiệm...";

            // 1. Di chuyển ống hút
            dropper.setAttribute('animation', {
                property: 'position',
                to: '0 5.5 0', // Cao hơn miệng ống nghiệm một chút
                dur: 1000,
                easing: 'easeInOutCubic'
            });
            
            dropper.setAttribute('animation__rotate', {
                property: 'rotation',
                to: '0 0 0',
                dur: 1000,
                easing: 'easeInOutCubic'
            });

            // 2. Tạo hiệu ứng nhỏ giọt
            setTimeout(() => {
                iodineDrop.setAttribute('visible', 'true');
                iodineDrop.setAttribute('position', '0 5.0 0'); // Xuất phát từ đầu ống hút
                
                // Rơi xuống
                iodineDrop.setAttribute('animation', {
                    property: 'position',
                    to: '0 3.0 0', // Rơi chạm mặt thoáng
                    dur: 600,
                    easing: 'easeInQuad'
                });

                // 3. Phản ứng đổi màu
                setTimeout(() => {
                    iodineDrop.setAttribute('visible', 'false'); // Biến mất khi chạm
                    statusText.textContent = "Phản ứng xảy ra!";
                    instruction.textContent = "Dung dịch chuyển màu Xanh Tím đặc trưng.";
                    
                    // Cấu hình animation đổi màu
                    const animConfig = {
                        property: 'material.color',
                        to: COLOR_REACTION,
                        dur: 1500,
                        easing: 'linear'
                    };

                    liquid.setAttribute('animation', animConfig);
                    liquidBottom.setAttribute('animation', animConfig);
                    liquidSurface.setAttribute('animation', animConfig);

                    // Hiển thị nút Reset
                    setTimeout(() => {
                        actionBtn.style.display = 'none';
                        resetBtn.style.display = 'inline-block';
                    }, 1500);

                }, 600);

            }, 1200);
        }

        function resetExperiment() {
            // Reset UI
            actionBtn.style.display = 'inline-block';
            actionBtn.disabled = false;
            resetBtn.style.display = 'none';
            statusText.textContent = "Sẵn sàng. Ống nghiệm chứa 2ml hồ tinh bột 1%.";
            instruction.textContent = "Bấm nút để bắt đầu lại.";

            // Reset 3D Objects
            // Reset màu sắc (dùng setAttribute cho material.color thay vì color attribute trực tiếp)
            liquid.setAttribute('material', 'color', COLOR_STARCH);
            liquidBottom.setAttribute('material', 'color', COLOR_STARCH);
            liquidSurface.setAttribute('material', 'color', COLOR_STARCH);
            
            liquid.removeAttribute('animation');
            liquidBottom.removeAttribute('animation');
            liquidSurface.removeAttribute('animation');

            // Ống hút về vị trí cũ
            dropper.removeAttribute('animation');
            dropper.removeAttribute('animation__rotate');
            dropper.setAttribute('position', '2 6 0');
            dropper.setAttribute('rotation', '0 0 -25');

            // Giọt nước ẩn đi
            iodineDrop.setAttribute('visible', 'false');
            iodineDrop.removeAttribute('animation');
        }
    </script>
</body>
</html>
