<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <title>AR Floating Lab - H·ªì Tinh B·ªôt & Iodine</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        
        #ui-layer {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            width: 85%;
            max-width: 450px;
            z-index: 100;
            pointer-events: none;
        }

        .glass-panel {
            background: rgba(0, 15, 30, 0.95);
            backdrop-filter: blur(20px);
            border: 2px solid #00f2fe;
            border-radius: 25px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 0 30px rgba(0, 242, 254, 0.3);
            pointer-events: auto;
        }

        h2 { margin: 0 0 10px 0; font-size: 18px; color: #00f2fe; text-transform: uppercase; letter-spacing: 2px; }
        p { margin: 0 0 15px 0; font-size: 14px; color: #ffffff; line-height: 1.5; font-weight: 600; }

        button {
            background: linear-gradient(45deg, #00f2fe 0%, #4facfe 100%);
            border: none;
            padding: 14px 30px;
            border-radius: 50px;
            color: #0a192f;
            font-weight: 800;
            cursor: pointer;
            transition: 0.3s;
            text-transform: uppercase;
            font-size: 14px;
            box-shadow: 0 5px 15px rgba(0, 242, 254, 0.4);
        }

        button:hover { transform: scale(1.05); background: #ffffff; }
        button:disabled { background: #333; color: #666; cursor: not-allowed; box-shadow: none; }

        #guide {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            color: #00f2fe;
            padding: 15px;
            border-radius: 12px;
            font-size: 13px;
            font-weight: bold;
            border: 1px solid #00f2fe;
            line-height: 1.6;
        }
        #guide span { color: #fff; font-weight: normal; }
    </style>
</head>
<body>

    <div id="guide">
        üß™ PH√íNG TH√ç NGHI·ªÜM ·∫¢O<br>
        <span>‚Ä¢ Marker: Hiro</span><br>
        <span>‚Ä¢ Vu·ªët ƒë·ªÉ xoay d·ª•ng c·ª•</span><br>
        <span>‚Ä¢ Ch·ª•m ƒë·ªÉ ph√≥ng to/nh·ªè</span>
    </div>

    <div id="ui-layer">
        <div class="glass-panel">
            <h2 id="step-title">Tinh b·ªôt & Iodine</h2>
            <p id="status-text">ƒêang ƒë·ª£i nh·∫≠n di·ªán Marker Hiro...</p>
            <div class="btn-container">
                <button id="main-btn" onclick="handleAction()">B·∫Øt ƒë·∫ßu th√≠ nghi·ªám</button>
            </div>
        </div>
    </div>

    <a-scene 
        embedded 
        arjs="sourceType: webcam; debugUIEnabled: false;" 
        renderer="antialias: true; colorManagement: true; logarithmicDepthBuffer: true;"
        vr-mode-ui="enabled: false">

        <a-assets>
            <a-mixin id="glass-mat" material="color: #ffffff; opacity: 0.2; transparent: true; metalness: 0.9; roughness: 0.1; side: double"></a-mixin>
            <a-mixin id="label-text" text="align: center; color: #ffffff; width: 3; font: https://cdn.aframe.io/fonts/Exo2Bold.fnt"></a-mixin>
        </a-assets>

        <a-marker preset="hiro" id="marker">
            <a-entity id="rig" position="0 0 0">
                
                <!-- 1. ·ªêNG NGHI·ªÜM TRUNG T√ÇM (H·ªí TINH B·ªòT) -->
                <a-entity id="test-tube-container" position="0 1.5 0.5">
                    <!-- Nh√£n ·ªëng nghi·ªám -->
                    <a-entity position="0 2.2 0">
                        <a-text mixin="label-text" value="Starch Solution" color="#00f2fe"></a-text>
                        <a-text mixin="label-text" value="(C6H10O5)n" position="0 -0.25 0" scale="0.7 0.7 0.7"></a-text>
                    </a-entity>

                    <a-entity id="tube-body">
                        <a-cylinder height="4" radius="0.35" mixin="glass-mat"></a-cylinder>
                        <a-sphere position="0 -2 0" radius="0.35" theta-length="90" rotation="180 0 0" mixin="glass-mat"></a-sphere>
                        
                        <!-- H√ìA CH·∫§T: Ban ƒë·∫ßu tr·ªëng, d√¢ng l√™n 1/2 (cao 2 ƒë∆°n v·ªã) -->
                        <a-entity id="liquid-group">
                            <a-cylinder id="liquid" height="0.01" radius="0.34" position="0 -2 0" material="color: #ffffff; opacity: 0.95; metalness: 0.1; roughness: 0.4"></a-cylinder>
                            <a-circle id="liquid-surface" radius="0.34" position="0 -2 0" rotation="-90 0 0" material="color: #ffffff; opacity: 1"></a-circle>
                        </a-entity>
                    </a-entity>
                </a-entity>

                <!-- 2. L·ªå IODINE V√Ä PIPETTE (B√äN PH·∫¢I) -->
                <a-entity id="iodine-system" position="2 1.0 0.2">
                    <!-- L·ªç ƒë·ª±ng Iodine -->
                    <a-cylinder height="1.5" radius="0.4" material="color: #331100; opacity: 0.95"></a-cylinder>
                    <a-text mixin="label-text" value="Iodine Solution" position="0 1.2 0" color="#ffaa00"></a-text>
                    <a-text mixin="label-text" value="I2 / KI" position="0 0.95 0" scale="0.8 0.8 0.8" color="#ffaa00"></a-text>
                    
                    <a-entity id="pipette" position="0 1.5 0" rotation="0 0 -15">
                        <a-sphere radius="0.12" scale="1 1.4 1" position="0 1 0" material="color: #111"></a-sphere> 
                        <a-cylinder height="2" radius="0.025" mixin="glass-mat"></a-cylinder>
                        <a-cylinder id="pipette-liquid" height="0.6" radius="0.018" position="0 -0.4 0" material="color: #7b3f00"></a-cylinder> 
                        <a-cone height="0.3" radius-bottom="0.025" radius-top="0.005" position="0 -1.15 0" mixin="glass-mat"></a-cone>
                    </a-entity>
                </a-entity>

                <!-- 3. C·ªêC N∆Ø·ªöC N√ìNG (B√äN TR√ÅI PH√çA TR√äN) -->
                <a-entity id="hot-beaker" position="-1.8 0.8 -1">
                    <a-text mixin="label-text" value="Hot Water" position="0 1.8 0" color="#ff3300"></a-text>
                    <a-text mixin="label-text" value="~70 C" position="0 1.55 0" scale="0.7 0.7 0.7" color="#ff3300"></a-text>
                    <a-cylinder height="2.5" radius="0.9" mixin="glass-mat" open-ended="true"></a-cylinder>
                    <a-cylinder height="0.1" radius="0.9" position="0 -1.25 0" mixin="glass-mat"></a-cylinder>
                    <a-cylinder height="1.8" radius="0.88" position="0 -0.3 0" material="color: #ff3300; opacity: 0.3; transparent: true"></a-cylinder>
                </a-entity>

                <!-- 4. C·ªêC N∆Ø·ªöC L·∫†NH (B√äN TR√ÅI PH√çA D∆Ø·ªöI) -->
                <a-entity id="cold-beaker" position="-2.2 0.8 1">
                    <a-text mixin="label-text" value="Cold Water" position="0 1.8 0" color="#0099ff"></a-text>
                    <a-text mixin="label-text" value="~10 C" position="0 1.55 0" scale="0.7 0.7 0.7" color="#0099ff"></a-text>
                    <a-cylinder height="2.5" radius="0.9" mixin="glass-mat" open-ended="true"></a-cylinder>
                    <a-cylinder height="0.1" radius="0.9" position="0 -1.25 0" mixin="glass-mat"></a-cylinder>
                    <a-cylinder height="1.8" radius="0.88" position="0 -0.3 0" material="color: #0099ff; opacity: 0.3; transparent: true"></a-cylinder>
                </a-entity>

                <!-- Gi·ªçt Iodine r∆°i -->
                <a-sphere id="iodine-drop" radius="0.03" material="color: #7b3f00" visible="false"></a-sphere>

                <a-entity light="type: ambient; intensity: 0.7"></a-entity>
                <a-entity light="type: directional; intensity: 0.8" position="2 4 3"></a-entity>
            </a-entity>
        </a-marker>

        <a-entity camera></a-entity>
    </a-scene>

    <script>
        const marker = document.querySelector('#marker');
        const rig = document.querySelector('#rig');
        const liquid = document.querySelector('#liquid');
        const liquidSurface = document.querySelector('#liquid-surface');
        const pipette = document.querySelector('#pipette');
        const statusText = document.querySelector('#status-text');
        const mainBtn = document.querySelector('#main-btn');

        let currentStep = 0;
        let userRotationY = 0;

        // T·ª± ƒë·ªông c√¢n b·∫±ng Rig theo Marker
        function autoLeveling() {
            if (marker.object3D.visible) {
                const markerRotation = marker.object3D.rotation;
                rig.object3D.rotation.x = -markerRotation.x;
                rig.object3D.rotation.z = -markerRotation.z;
                rig.object3D.rotation.y = userRotationY;
            }
            requestAnimationFrame(autoLeveling);
        }
        autoLeveling();

        // Xoay b·∫±ng vu·ªët m√†n h√¨nh
        let touchX = 0;
        window.addEventListener('touchstart', e => touchX = e.touches[0].pageX);
        window.addEventListener('touchmove', e => {
            if (e.touches.length === 1) {
                let delta = e.touches[0].pageX - touchX;
                userRotationY += delta * 0.01;
                touchX = e.touches[0].pageX;
            }
        });

        // H√ÄNH ƒê·ªòNG TH√ç NGHI·ªÜM
        async function handleAction() {
            mainBtn.disabled = true;

            if (currentStep === 0) {
                // B∆Ø·ªöC 1: R√≥t tinh b·ªôt
                statusText.textContent = "B∆∞·ªõc 1: R√≥t 2mL h·ªì tinh b·ªôt tr·∫Øng ƒë·ª•c v√†o ·ªëng nghi·ªám.";
                liquid.setAttribute('animation', { property: 'height', to: 2, dur: 2000, easing: 'linear' });
                liquid.setAttribute('animation__pos', { property: 'position', to: '0 -1 0', dur: 2000, easing: 'linear' });
                liquidSurface.setAttribute('animation', { property: 'position', to: '0 0 0', dur: 2000, easing: 'linear' });
                
                await new Promise(r => setTimeout(r, 2200));
                statusText.textContent = "H·ªì tinh b·ªôt s·∫µn s√†ng. Chu·∫©n b·ªã nh·ªè Iodine.";
                mainBtn.textContent = "Nh·ªè Iodine & L·∫Øc ƒë·ªÅu";
                currentStep = 1;
            } 
            else if (currentStep === 1) {
                // B∆Ø·ªöC 2: Nh·ªè Iodine & L·∫Øc
                statusText.textContent = "B∆∞·ªõc 2: Nh·ªè Iodine Solution (I2/KI) v√†o v√† l·∫Øc ƒë·ªÅu.";
                pipette.setAttribute('animation', { property: 'position', to: '-1.8 1.5 0.3', dur: 1000 });
                pipette.setAttribute('animation__2', { property: 'rotation', to: '0 0 0', dur: 800 });
                
                await new Promise(r => setTimeout(r, 1100));
                const drop = document.querySelector('#iodine-drop');
                drop.setAttribute('visible', 'true');
                drop.setAttribute('position', '0 2.2 0.5');
                drop.setAttribute('animation', { property: 'position', to: '0 0.5 0.5', dur: 600 });
                
                await new Promise(r => setTimeout(r, 600));
                drop.setAttribute('visible', 'false');
                
                // Hi·ªáu ·ª©ng l·∫Øc
                document.querySelector('#tube-body').setAttribute('animation', {
                    property: 'rotation', to: '0 0 10', dur: 200, dir: 'alternate', loop: 6
                });
                
                // Chuy·ªÉn m√†u xanh t√≠m ƒë·∫≠m
                liquid.setAttribute('animation', { property: 'material.color', to: '#080033', dur: 1500 });
                liquidSurface.setAttribute('animation', { property: 'material.color', to: '#080033', dur: 1500 });
                
                await new Promise(r => setTimeout(r, 1600));
                statusText.textContent = "Hi·ªán t∆∞·ª£ng: Dung d·ªãch chuy·ªÉn m√†u XANH T√çM ƒë·∫∑c tr∆∞ng.";
                mainBtn.textContent = "Nh√∫ng v√†o Hot Water";
                currentStep = 2;
            }
            else if (currentStep === 2) {
                // B∆Ø·ªöC 3: N∆∞·ªõc n√≥ng
                statusText.textContent = "B∆∞·ªõc 3: Nh√∫ng v√†o Hot Water. Iodine b·ªã ƒë·∫©y ra kh·ªèi tinh b·ªôt.";
                document.querySelector('#test-tube-container').setAttribute('animation', {
                    property: 'position', to: '-1.8 1.2 -1', dur: 1500, easing: 'easeInOutQuad'
                });
                
                await new Promise(r => setTimeout(r, 1800));
                liquid.setAttribute('animation', { property: 'material.color', to: '#ffffff', dur: 3000 });
                liquidSurface.setAttribute('animation', { property: 'material.color', to: '#ffffff', dur: 3000 });
                
                await new Promise(r => setTimeout(r, 3200));
                statusText.textContent = "K·∫øt qu·∫£: M√†u xanh t√≠m bi·∫øn m·∫•t (tr·ªü l·∫°i tr·∫Øng ƒë·ª•c).";
                mainBtn.textContent = "Nh√∫ng v√†o Cold Water";
                currentStep = 3;
            }
            else if (currentStep === 3) {
                // B∆Ø·ªöC 4: N∆∞·ªõc l·∫°nh
                statusText.textContent = "B∆∞·ªõc 4: Nh√∫ng v√†o Cold Water. C·∫•u tr√∫c xo·∫Øn ph·ª•c h·ªìi, Iodine t√°i h·∫•p ph·ª•.";
                document.querySelector('#test-tube-container').setAttribute('animation', {
                    property: 'position', to: '-2.2 1.2 1', dur: 1500, easing: 'easeInOutQuad'
                });
                
                await new Promise(r => setTimeout(r, 1800));
                liquid.setAttribute('animation', { property: 'material.color', to: '#080033', dur: 3000 });
                liquidSurface.setAttribute('animation', { property: 'material.color', to: '#080033', dur: 3000 });
                
                await new Promise(r => setTimeout(r, 3200));
                statusText.textContent = "K·∫øt qu·∫£: M√†u xanh t√≠m xu·∫•t hi·ªán tr·ªü l·∫°i.";
                mainBtn.textContent = "L√†m l·∫°i t·ª´ ƒë·∫ßu";
                currentStep = 4;
            } else {
                location.reload();
            }

            mainBtn.disabled = false;
        }

        marker.addEventListener('markerFound', () => { 
            statusText.textContent = "Marker Hiro ƒë√£ nh·∫≠n di·ªán. S·∫µn s√†ng th√≠ nghi·ªám!"; 
        });
        marker.addEventListener('markerLost', () => {
            statusText.textContent = "M·∫•t d·∫•u Marker. H√£y ƒë∆∞a th·∫ª Hiro l·∫°i tr∆∞·ªõc camera.";
        });
    </script>
</body>
</html>
